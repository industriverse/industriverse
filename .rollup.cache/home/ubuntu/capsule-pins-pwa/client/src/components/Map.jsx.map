{"version":3,"file":"Map.jsx","sourceRoot":"","sources":["Map.tsx"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA0EG;;AAEH,4CAA4C;AAE5C,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAC1C,OAAO,EAAE,YAAY,EAAE,MAAM,sBAAsB,CAAC;AACpD,OAAO,EAAE,EAAE,EAAE,MAAM,aAAa,CAAC;AAQjC,IAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,2BAA2B,CAAC;AAC5D,IAAM,cAAc,GAClB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,2BAA2B;IAC3C,oCAAoC,CAAC;AACvC,IAAM,cAAc,GAAG,UAAG,cAAc,mBAAgB,CAAC;AAEzD,SAAS,aAAa;IACpB,OAAO,IAAI,OAAO,CAAC,UAAA,OAAO;QACxB,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,CAAC,GAAG,GAAG,UAAG,cAAc,8BAAoB,OAAO,yDAAsD,CAAC;QAChH,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;QACpB,MAAM,CAAC,WAAW,GAAG,WAAW,CAAC;QACjC,MAAM,CAAC,MAAM,GAAG;YACd,OAAO,CAAC,IAAI,CAAC,CAAC;YACd,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,uBAAuB;QAC1C,CAAC,CAAC;QACF,MAAM,CAAC,OAAO,GAAG;YACf,OAAO,CAAC,KAAK,CAAC,mCAAmC,CAAC,CAAC;QACrD,CAAC,CAAC;QACF,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;AACL,CAAC;AASD,MAAM,UAAU,OAAO,CAAC,EAKT;IALf,iBAoCC;QAnCC,SAAS,eAAA,EACT,qBAAgD,EAAhD,aAAa,mBAAG,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,QAAQ,EAAE,KAAA,EAChD,mBAAgB,EAAhB,WAAW,mBAAG,EAAE,KAAA,EAChB,UAAU,gBAAA;IAEV,IAAM,YAAY,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IAClD,IAAM,GAAG,GAAG,MAAM,CAAyB,IAAI,CAAC,CAAC;IAEjD,IAAM,IAAI,GAAG,YAAY,CAAC;;;wBACxB,qBAAM,aAAa,EAAE,EAAA;;oBAArB,SAAqB,CAAC;oBACtB,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;wBAC1B,OAAO,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;wBACzC,sBAAO;oBACT,CAAC;oBACD,GAAG,CAAC,OAAO,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE;wBAC7D,IAAI,EAAE,WAAW;wBACjB,MAAM,EAAE,aAAa;wBACrB,cAAc,EAAE,IAAI;wBACpB,iBAAiB,EAAE,IAAI;wBACvB,WAAW,EAAE,IAAI;wBACjB,iBAAiB,EAAE,IAAI;wBACvB,KAAK,EAAE,aAAa;qBACrB,CAAC,CAAC;oBACH,IAAI,UAAU,EAAE,CAAC;wBACf,UAAU,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBAC1B,CAAC;;;;SACF,CAAC,CAAC;IAEH,SAAS,CAAC;QACR,IAAI,EAAE,CAAC;IACT,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;IAEX,OAAO,CACL,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,kBAAkB,EAAE,SAAS,CAAC,CAAC,EAAG,CACzE,CAAC;AACJ,CAAC","sourcesContent":["/**\n * GOOGLE MAPS FRONTEND INTEGRATION - ESSENTIAL GUIDE\n *\n * USAGE FROM PARENT COMPONENT:\n * ======\n *\n * const mapRef = useRef<google.maps.Map | null>(null);\n *\n * <MapView\n *   initialCenter={{ lat: 40.7128, lng: -74.0060 }}\n *   initialZoom={15}\n *   onMapReady={(map) => {\n *     mapRef.current = map; // Store to control map from parent anytime, google map itself is in charge of the re-rendering, not react state.\n * </MapView>\n *\n * ======\n * Available Libraries and Core Features:\n * -------------------------------\n * üìç MARKER (from `marker` library)\n * - Attaches to map using { map, position }\n * new google.maps.marker.AdvancedMarkerElement({\n *   map,\n *   position: { lat: 37.7749, lng: -122.4194 },\n *   title: \"San Francisco\",\n * });\n *\n * -------------------------------\n * üè¢ PLACES (from `places` library)\n * - Does not attach directly to map; use data with your map manually.\n * const place = new google.maps.places.Place({ id: PLACE_ID });\n * await place.fetchFields({ fields: [\"displayName\", \"location\"] });\n * map.setCenter(place.location);\n * new google.maps.marker.AdvancedMarkerElement({ map, position: place.location });\n *\n * -------------------------------\n * üß≠ GEOCODER (from `geocoding` library)\n * - Standalone service; manually apply results to map.\n * const geocoder = new google.maps.Geocoder();\n * geocoder.geocode({ address: \"New York\" }, (results, status) => {\n *   if (status === \"OK\" && results[0]) {\n *     map.setCenter(results[0].geometry.location);\n *     new google.maps.marker.AdvancedMarkerElement({\n *       map,\n *       position: results[0].geometry.location,\n *     });\n *   }\n * });\n *\n * -------------------------------\n * üìê GEOMETRY (from `geometry` library)\n * - Pure utility functions; not attached to map.\n * const dist = google.maps.geometry.spherical.computeDistanceBetween(p1, p2);\n *\n * -------------------------------\n * üõ£Ô∏è ROUTES (from `routes` library)\n * - Combines DirectionsService (standalone) + DirectionsRenderer (map-attached)\n * const directionsService = new google.maps.DirectionsService();\n * const directionsRenderer = new google.maps.DirectionsRenderer({ map });\n * directionsService.route(\n *   { origin, destination, travelMode: \"DRIVING\" },\n *   (res, status) => status === \"OK\" && directionsRenderer.setDirections(res)\n * );\n *\n * -------------------------------\n * üå¶Ô∏è MAP LAYERS (attach directly to map)\n * - new google.maps.TrafficLayer().setMap(map);\n * - new google.maps.TransitLayer().setMap(map);\n * - new google.maps.BicyclingLayer().setMap(map);\n *\n * -------------------------------\n * ‚úÖ SUMMARY\n * - ‚Äúmap-attached‚Äù ‚Üí AdvancedMarkerElement, DirectionsRenderer, Layers.\n * - ‚Äústandalone‚Äù ‚Üí Geocoder, DirectionsService, DistanceMatrixService, ElevationService.\n * - ‚Äúdata-only‚Äù ‚Üí Place, Geometry utilities.\n */\n\n/// <reference types=\"@types/google.maps\" />\n\nimport { useEffect, useRef } from \"react\";\nimport { usePersistFn } from \"@/hooks/usePersistFn\";\nimport { cn } from \"@/lib/utils\";\n\ndeclare global {\n  interface Window {\n    google?: typeof google;\n  }\n}\n\nconst API_KEY = import.meta.env.VITE_FRONTEND_FORGE_API_KEY;\nconst FORGE_BASE_URL =\n  import.meta.env.VITE_FRONTEND_FORGE_API_URL ||\n  \"https://forge.butterfly-effect.dev\";\nconst MAPS_PROXY_URL = `${FORGE_BASE_URL}/v1/maps/proxy`;\n\nfunction loadMapScript() {\n  return new Promise(resolve => {\n    const script = document.createElement(\"script\");\n    script.src = `${MAPS_PROXY_URL}/maps/api/js?key=${API_KEY}&v=weekly&libraries=marker,places,geocoding,geometry`;\n    script.async = true;\n    script.crossOrigin = \"anonymous\";\n    script.onload = () => {\n      resolve(null);\n      script.remove(); // Clean up immediately\n    };\n    script.onerror = () => {\n      console.error(\"Failed to load Google Maps script\");\n    };\n    document.head.appendChild(script);\n  });\n}\n\ninterface MapViewProps {\n  className?: string;\n  initialCenter?: google.maps.LatLngLiteral;\n  initialZoom?: number;\n  onMapReady?: (map: google.maps.Map) => void;\n}\n\nexport function MapView({\n  className,\n  initialCenter = { lat: 37.7749, lng: -122.4194 },\n  initialZoom = 12,\n  onMapReady,\n}: MapViewProps) {\n  const mapContainer = useRef<HTMLDivElement>(null);\n  const map = useRef<google.maps.Map | null>(null);\n\n  const init = usePersistFn(async () => {\n    await loadMapScript();\n    if (!mapContainer.current) {\n      console.error(\"Map container not found\");\n      return;\n    }\n    map.current = new window.google.maps.Map(mapContainer.current, {\n      zoom: initialZoom,\n      center: initialCenter,\n      mapTypeControl: true,\n      fullscreenControl: true,\n      zoomControl: true,\n      streetViewControl: true,\n      mapId: \"DEMO_MAP_ID\",\n    });\n    if (onMapReady) {\n      onMapReady(map.current);\n    }\n  });\n\n  useEffect(() => {\n    init();\n  }, [init]);\n\n  return (\n    <div ref={mapContainer} className={cn(\"w-full h-[500px]\", className)} />\n  );\n}\n"]}