{"version":3,"file":"useCapsuleWebSocket.js","sourceRoot":"","sources":["useCapsuleWebSocket.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * useCapsuleWebSocket Hook\n * \n * React hook for managing WebSocket connection to Capsule Gateway.\n * Provides easy integration with React components.\n */\n\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { CapsuleWebSocket, type ConnectionState, type WebSocketMessage } from '@/services/CapsuleWebSocket';\nimport type { CapsuleData, CapsuleUpdate } from '@/types/capsule';\n\nexport interface UseCapsuleWebSocketOptions {\n  url: string;\n  authToken?: string;\n  autoConnect?: boolean;\n  onCapsuleUpdate?: (update: CapsuleUpdate) => void;\n  onCapsuleNew?: (capsule: CapsuleData) => void;\n  onCapsuleRemoved?: (capsuleId: string) => void;\n  onError?: (error: Error) => void;\n}\n\nexport interface UseCapsuleWebSocketReturn {\n  connectionState: ConnectionState;\n  connect: () => void;\n  disconnect: () => void;\n  send: (message: object) => void;\n  isConnected: boolean;\n  isConnecting: boolean;\n  isDisconnected: boolean;\n  hasError: boolean;\n}\n\nexport function useCapsuleWebSocket(options: UseCapsuleWebSocketOptions): UseCapsuleWebSocketReturn {\n  const [connectionState, setConnectionState] = useState<ConnectionState>('disconnected');\n  const wsRef = useRef<CapsuleWebSocket | null>(null);\n\n  // Initialize WebSocket instance\n  useEffect(() => {\n    const ws = new CapsuleWebSocket({\n      url: options.url,\n      authToken: options.authToken,\n      onStateChange: setConnectionState,\n      onMessage: (message: WebSocketMessage) => {\n        switch (message.type) {\n          case 'capsule_update':\n            options.onCapsuleUpdate?.(message.data);\n            break;\n          case 'capsule_new':\n            options.onCapsuleNew?.(message.data);\n            break;\n          case 'capsule_removed':\n            options.onCapsuleRemoved?.(message.data.capsuleId);\n            break;\n          case 'error':\n            options.onError?.(new Error(message.data.message));\n            break;\n        }\n      },\n      onError: options.onError\n    });\n\n    wsRef.current = ws;\n\n    // Auto-connect if enabled\n    if (options.autoConnect !== false) {\n      ws.connect();\n    }\n\n    // Cleanup on unmount\n    return () => {\n      ws.disconnect();\n    };\n  }, [options.url, options.authToken, options.autoConnect]);\n\n  // Update auth token when it changes\n  useEffect(() => {\n    if (options.authToken && wsRef.current) {\n      wsRef.current.updateAuthToken(options.authToken);\n    }\n  }, [options.authToken]);\n\n  const connect = useCallback(() => {\n    wsRef.current?.connect();\n  }, []);\n\n  const disconnect = useCallback(() => {\n    wsRef.current?.disconnect();\n  }, []);\n\n  const send = useCallback((message: object) => {\n    wsRef.current?.send(message);\n  }, []);\n\n  return {\n    connectionState,\n    connect,\n    disconnect,\n    send,\n    isConnected: connectionState === 'connected',\n    isConnecting: connectionState === 'connecting',\n    isDisconnected: connectionState === 'disconnected',\n    hasError: connectionState === 'error'\n  };\n}\n"]}