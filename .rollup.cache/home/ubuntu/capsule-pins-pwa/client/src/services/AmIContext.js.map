{"version":3,"file":"AmIContext.js","sourceRoot":"","sources":["AmIContext.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * AmI Context Awareness Module\n * Week 8: White-Label Platform - Phase 3\n * \n * Implements the 4 AmI principles:\n * 1. Context-awareness - Perceives user state automatically\n * 2. Proactivity - Anticipates needs without commands\n * 3. Seamless integration - Intelligence blends invisibly\n * 4. Adaptivity - Uniquely tailored per user\n */\n\nimport { AmIPrinciples, LocalPattern, getCosmicFabric } from './CosmicFabric';\n\nexport interface UserContext {\n  userId: string;\n  sessionId: string;\n  location: 'home' | 'settings' | 'catalog' | 'widgets' | 'admin';\n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n  deviceType: 'mobile' | 'tablet' | 'desktop';\n  networkQuality: 'excellent' | 'good' | 'poor' | 'offline';\n  batteryLevel?: number; // 0-100\n  preferences: Record<string, any>;\n  recentActions: string[];\n  timestamp: number;\n}\n\nexport interface PredictedNeed {\n  type: 'navigation' | 'action' | 'information' | 'optimization';\n  suggestion: string;\n  confidence: number; // 0-1\n  reasoning: string;\n  timestamp: number;\n}\n\nexport interface AdaptiveRule {\n  id: string;\n  condition: (context: UserContext) => boolean;\n  action: (context: UserContext) => void;\n  priority: number;\n  enabled: boolean;\n}\n\nexport class AmIContextService {\n  private context: UserContext;\n  private adaptiveRules: AdaptiveRule[] = [];\n  private predictionHistory: PredictedNeed[] = [];\n  private contextHistory: UserContext[] = [];\n  private maxHistorySize = 100;\n\n  constructor(userId: string) {\n    this.context = this.initializeContext(userId);\n    this.setupDefaultRules();\n    this.startContextMonitoring();\n  }\n\n  /**\n   * Initialize user context\n   */\n  private initializeContext(userId: string): UserContext {\n    return {\n      userId,\n      sessionId: this.generateSessionId(),\n      location: 'home',\n      timeOfDay: this.getTimeOfDay(),\n      deviceType: this.detectDeviceType(),\n      networkQuality: 'good',\n      preferences: {},\n      recentActions: [],\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Start monitoring context changes\n   */\n  private startContextMonitoring(): void {\n    // Monitor location changes\n    window.addEventListener('popstate', () => {\n      this.updateLocation();\n    });\n\n    // Monitor network quality\n    if ('connection' in navigator) {\n      const connection = (navigator as any).connection;\n      connection.addEventListener('change', () => {\n        this.updateNetworkQuality();\n      });\n    }\n\n    // Monitor battery level (if available)\n    if ('getBattery' in navigator) {\n      (navigator as any).getBattery().then((battery: any) => {\n        this.context.batteryLevel = battery.level * 100;\n        battery.addEventListener('levelchange', () => {\n          this.context.batteryLevel = battery.level * 100;\n          this.onContextChange();\n        });\n      });\n    }\n\n    // Update time of day every minute\n    setInterval(() => {\n      const newTimeOfDay = this.getTimeOfDay();\n      if (newTimeOfDay !== this.context.timeOfDay) {\n        this.context.timeOfDay = newTimeOfDay;\n        this.onContextChange();\n      }\n    }, 60000);\n  }\n\n  /**\n   * Update current location\n   */\n  private updateLocation(): void {\n    const path = window.location.pathname;\n    let location: UserContext['location'] = 'home';\n    \n    if (path.includes('/settings')) location = 'settings';\n    else if (path.includes('/catalog')) location = 'catalog';\n    else if (path.includes('/widgets')) location = 'widgets';\n    else if (path.includes('/admin')) location = 'admin';\n\n    if (location !== this.context.location) {\n      this.context.location = location;\n      this.onContextChange();\n    }\n  }\n\n  /**\n   * Update network quality\n   */\n  private updateNetworkQuality(): void {\n    if ('connection' in navigator) {\n      const connection = (navigator as any).connection;\n      const effectiveType = connection.effectiveType;\n      \n      let quality: UserContext['networkQuality'] = 'good';\n      if (effectiveType === '4g') quality = 'excellent';\n      else if (effectiveType === '3g') quality = 'good';\n      else if (effectiveType === '2g') quality = 'poor';\n      else if (!navigator.onLine) quality = 'offline';\n\n      if (quality !== this.context.networkQuality) {\n        this.context.networkQuality = quality;\n        this.onContextChange();\n      }\n    }\n  }\n\n  /**\n   * Get time of day\n   */\n  private getTimeOfDay(): UserContext['timeOfDay'] {\n    const hour = new Date().getHours();\n    if (hour >= 5 && hour < 12) return 'morning';\n    if (hour >= 12 && hour < 17) return 'afternoon';\n    if (hour >= 17 && hour < 21) return 'evening';\n    return 'night';\n  }\n\n  /**\n   * Detect device type\n   */\n  private detectDeviceType(): UserContext['deviceType'] {\n    const width = window.innerWidth;\n    if (width < 768) return 'mobile';\n    if (width < 1024) return 'tablet';\n    return 'desktop';\n  }\n\n  /**\n   * Generate session ID\n   */\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Context changed - trigger AmI logic\n   */\n  private onContextChange(): void {\n    this.context.timestamp = Date.now();\n    \n    // Save to history\n    this.contextHistory.push({ ...this.context });\n    if (this.contextHistory.length > this.maxHistorySize) {\n      this.contextHistory.shift();\n    }\n\n    // Calculate AmI metrics\n    const amiMetrics = this.calculateAmIMetrics();\n\n    // Send to Cosmic Fabric for learning\n    const fabric = getCosmicFabric();\n    if (fabric) {\n      fabric.learnLocal({\n        type: 'user_behavior',\n        features: this.contextToFeatures(this.context),\n        confidence: 0.8,\n        amiPrinciples: amiMetrics,\n      });\n    }\n\n    // Run adaptive rules\n    this.runAdaptiveRules();\n\n    // Make predictions\n    this.predictUserNeeds();\n\n    // Emit event\n    window.dispatchEvent(new CustomEvent('ami-context-change', {\n      detail: { context: this.context, amiMetrics },\n    }));\n  }\n\n  /**\n   * Convert context to feature vector\n   */\n  private contextToFeatures(context: UserContext): number[] {\n    return [\n      context.location === 'home' ? 1 : 0,\n      context.location === 'settings' ? 1 : 0,\n      context.location === 'catalog' ? 1 : 0,\n      context.location === 'widgets' ? 1 : 0,\n      context.location === 'admin' ? 1 : 0,\n      context.timeOfDay === 'morning' ? 1 : 0,\n      context.timeOfDay === 'afternoon' ? 1 : 0,\n      context.timeOfDay === 'evening' ? 1 : 0,\n      context.timeOfDay === 'night' ? 1 : 0,\n      context.deviceType === 'mobile' ? 1 : 0,\n      context.deviceType === 'tablet' ? 1 : 0,\n      context.deviceType === 'desktop' ? 1 : 0,\n      context.networkQuality === 'excellent' ? 1 : 0,\n      context.networkQuality === 'good' ? 1 : 0,\n      context.networkQuality === 'poor' ? 1 : 0,\n      context.batteryLevel ? context.batteryLevel / 100 : 1,\n      context.recentActions.length / 10,\n    ];\n  }\n\n  /**\n   * Calculate AmI metrics\n   */\n  private calculateAmIMetrics(): AmIPrinciples {\n    const contextAwareness = this.calculateContextAwareness();\n    const proactivity = this.calculateProactivity();\n    const seamlessness = this.calculateSeamlessness();\n    const adaptivity = this.calculateAdaptivity();\n\n    return {\n      contextAwareness,\n      proactivity,\n      seamlessness,\n      adaptivity,\n    };\n  }\n\n  /**\n   * Calculate context awareness score\n   */\n  private calculateContextAwareness(): number {\n    // Based on how much context we're tracking\n    let score = 0;\n    if (this.context.location) score += 20;\n    if (this.context.timeOfDay) score += 20;\n    if (this.context.deviceType) score += 20;\n    if (this.context.networkQuality) score += 20;\n    if (this.context.batteryLevel !== undefined) score += 10;\n    if (this.context.recentActions.length > 0) score += 10;\n    return score;\n  }\n\n  /**\n   * Calculate proactivity score\n   */\n  private calculateProactivity(): number {\n    // Based on predictions made\n    const recentPredictions = this.predictionHistory.filter(\n      p => Date.now() - p.timestamp < 60000 // Last minute\n    );\n    return Math.min(100, recentPredictions.length * 20);\n  }\n\n  /**\n   * Calculate seamlessness score\n   */\n  private calculateSeamlessness(): number {\n    // Based on how invisible the AmI is (fewer interruptions)\n    const recentActions = this.context.recentActions.length;\n    return Math.max(0, 100 - recentActions * 5);\n  }\n\n  /**\n   * Calculate adaptivity score\n   */\n  private calculateAdaptivity(): number {\n    // Based on adaptive rules triggered\n    const enabledRules = this.adaptiveRules.filter(r => r.enabled).length;\n    return Math.min(100, enabledRules * 10);\n  }\n\n  /**\n   * Setup default adaptive rules\n   */\n  private setupDefaultRules(): void {\n    // Rule: Low battery + poor network = suggest offline mode\n    this.addAdaptiveRule({\n      id: 'low_battery_offline',\n      condition: (ctx) => \n        (ctx.batteryLevel || 100) < 20 && ctx.networkQuality === 'poor',\n      action: (ctx) => {\n        this.suggestAction('Enable offline mode to save battery', 0.8);\n      },\n      priority: 10,\n      enabled: true,\n    });\n\n    // Rule: Evening + home = suggest theme switch\n    this.addAdaptiveRule({\n      id: 'evening_dark_theme',\n      condition: (ctx) => \n        ctx.timeOfDay === 'evening' && ctx.location === 'home',\n      action: (ctx) => {\n        this.suggestAction('Switch to dark theme for better readability', 0.7);\n      },\n      priority: 5,\n      enabled: true,\n    });\n\n    // Rule: Mobile + catalog = suggest filters\n    this.addAdaptiveRule({\n      id: 'mobile_catalog_filters',\n      condition: (ctx) => \n        ctx.deviceType === 'mobile' && ctx.location === 'catalog',\n      action: (ctx) => {\n        this.suggestAction('Use filters to find capsules faster', 0.6);\n      },\n      priority: 3,\n      enabled: true,\n    });\n  }\n\n  /**\n   * Add adaptive rule\n   */\n  public addAdaptiveRule(rule: AdaptiveRule): void {\n    this.adaptiveRules.push(rule);\n    this.adaptiveRules.sort((a, b) => b.priority - a.priority);\n  }\n\n  /**\n   * Run adaptive rules\n   */\n  private runAdaptiveRules(): void {\n    for (const rule of this.adaptiveRules) {\n      if (rule.enabled && rule.condition(this.context)) {\n        rule.action(this.context);\n      }\n    }\n  }\n\n  /**\n   * Predict user needs\n   */\n  private predictUserNeeds(): void {\n    // Simple heuristic-based predictions\n    // In production, this would use the federated model from Cosmic Fabric\n\n    if (this.context.location === 'home' && this.context.recentActions.length === 0) {\n      this.addPrediction({\n        type: 'navigation',\n        suggestion: 'View capsule catalog',\n        confidence: 0.6,\n        reasoning: 'Users typically browse catalog after landing',\n        timestamp: Date.now(),\n      });\n    }\n\n    if (this.context.location === 'catalog' && this.context.recentActions.includes('search')) {\n      this.addPrediction({\n        type: 'action',\n        suggestion: 'Apply filters to refine search',\n        confidence: 0.7,\n        reasoning: 'Search followed by filtering is common pattern',\n        timestamp: Date.now(),\n      });\n    }\n  }\n\n  /**\n   * Add prediction\n   */\n  private addPrediction(prediction: PredictedNeed): void {\n    this.predictionHistory.push(prediction);\n    if (this.predictionHistory.length > this.maxHistorySize) {\n      this.predictionHistory.shift();\n    }\n\n    // Emit event\n    window.dispatchEvent(new CustomEvent('ami-prediction', {\n      detail: prediction,\n    }));\n  }\n\n  /**\n   * Suggest action to user\n   */\n  private suggestAction(suggestion: string, confidence: number): void {\n    console.log(`[AmI] Suggestion: ${suggestion} (confidence: ${confidence})`);\n    \n    // In production, this would show a subtle notification\n    // For now, just log and emit event\n    window.dispatchEvent(new CustomEvent('ami-suggestion', {\n      detail: { suggestion, confidence },\n    }));\n  }\n\n  /**\n   * Record user action\n   */\n  public recordAction(action: string): void {\n    this.context.recentActions.push(action);\n    if (this.context.recentActions.length > 20) {\n      this.context.recentActions.shift();\n    }\n    this.onContextChange();\n  }\n\n  /**\n   * Get current context\n   */\n  public getContext(): UserContext {\n    return { ...this.context };\n  }\n\n  /**\n   * Get predictions\n   */\n  public getPredictions(): PredictedNeed[] {\n    return [...this.predictionHistory];\n  }\n\n  /**\n   * Update user preferences\n   */\n  public updatePreferences(preferences: Record<string, any>): void {\n    this.context.preferences = { ...this.context.preferences, ...preferences };\n    this.onContextChange();\n  }\n}\n\n// Singleton instance\nlet amiContextInstance: AmIContextService | null = null;\n\nexport function initializeAmIContext(userId: string): AmIContextService {\n  if (!amiContextInstance) {\n    amiContextInstance = new AmIContextService(userId);\n  }\n  return amiContextInstance;\n}\n\nexport function getAmIContext(): AmIContextService | null {\n  return amiContextInstance;\n}\n"]}