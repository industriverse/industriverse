{"version":3,"file":"sw-register.js","sourceRoot":"","sources":["sw-register.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Service Worker Registration\n * \n * Handles service worker registration and updates\n */\n\nexport interface ServiceWorkerStatus {\n  registered: boolean;\n  installing: boolean;\n  waiting: boolean;\n  active: boolean;\n  error: Error | null;\n}\n\nexport type ServiceWorkerCallback = (status: ServiceWorkerStatus) => void;\n\nclass ServiceWorkerManager {\n  private registration: ServiceWorkerRegistration | null = null;\n  private callbacks: ServiceWorkerCallback[] = [];\n\n  /**\n   * Register service worker\n   */\n  async register(swUrl: string = '/sw.js'): Promise<ServiceWorkerRegistration | null> {\n    if (!('serviceWorker' in navigator)) {\n      console.warn('Service Worker not supported');\n      this.notifyCallbacks({\n        registered: false,\n        installing: false,\n        waiting: false,\n        active: false,\n        error: new Error('Service Worker not supported')\n      });\n      return null;\n    }\n\n    try {\n      console.log('Registering service worker...');\n      \n      this.registration = await navigator.serviceWorker.register(swUrl, {\n        scope: '/'\n      });\n\n      console.log('Service worker registered:', this.registration.scope);\n\n      // Listen for updates\n      this.registration.addEventListener('updatefound', () => {\n        console.log('Service worker update found');\n        this.handleUpdate();\n      });\n\n      // Check for updates periodically\n      setInterval(() => {\n        this.registration?.update();\n      }, 60 * 60 * 1000); // Check every hour\n\n      this.notifyCallbacks(this.getStatus());\n      return this.registration;\n    } catch (error) {\n      console.error('Service worker registration failed:', error);\n      this.notifyCallbacks({\n        registered: false,\n        installing: false,\n        waiting: false,\n        active: false,\n        error: error as Error\n      });\n      return null;\n    }\n  }\n\n  /**\n   * Unregister service worker\n   */\n  async unregister(): Promise<boolean> {\n    if (!this.registration) {\n      return false;\n    }\n\n    try {\n      const result = await this.registration.unregister();\n      console.log('Service worker unregistered:', result);\n      this.registration = null;\n      this.notifyCallbacks({\n        registered: false,\n        installing: false,\n        waiting: false,\n        active: false,\n        error: null\n      });\n      return result;\n    } catch (error) {\n      console.error('Service worker unregistration failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Update service worker\n   */\n  async update(): Promise<void> {\n    if (!this.registration) {\n      console.warn('No service worker registered');\n      return;\n    }\n\n    try {\n      await this.registration.update();\n      console.log('Service worker update check completed');\n    } catch (error) {\n      console.error('Service worker update failed:', error);\n    }\n  }\n\n  /**\n   * Skip waiting and activate new service worker\n   */\n  skipWaiting(): void {\n    if (!this.registration?.waiting) {\n      console.warn('No waiting service worker');\n      return;\n    }\n\n    this.registration.waiting.postMessage({ type: 'SKIP_WAITING' });\n  }\n\n  /**\n   * Get current status\n   */\n  getStatus(): ServiceWorkerStatus {\n    if (!this.registration) {\n      return {\n        registered: false,\n        installing: false,\n        waiting: false,\n        active: false,\n        error: null\n      };\n    }\n\n    return {\n      registered: true,\n      installing: !!this.registration.installing,\n      waiting: !!this.registration.waiting,\n      active: !!this.registration.active,\n      error: null\n    };\n  }\n\n  /**\n   * Subscribe to status changes\n   */\n  subscribe(callback: ServiceWorkerCallback): () => void {\n    this.callbacks.push(callback);\n    \n    // Immediately call with current status\n    callback(this.getStatus());\n\n    // Return unsubscribe function\n    return () => {\n      this.callbacks = this.callbacks.filter(cb => cb !== callback);\n    };\n  }\n\n  private handleUpdate(): void {\n    const installingWorker = this.registration?.installing;\n    if (!installingWorker) return;\n\n    installingWorker.addEventListener('statechange', () => {\n      if (installingWorker.state === 'installed') {\n        if (navigator.serviceWorker.controller) {\n          // New service worker available\n          console.log('New service worker available');\n          this.notifyCallbacks(this.getStatus());\n        } else {\n          // Service worker installed for first time\n          console.log('Service worker installed');\n          this.notifyCallbacks(this.getStatus());\n        }\n      }\n    });\n  }\n\n  private notifyCallbacks(status: ServiceWorkerStatus): void {\n    this.callbacks.forEach(callback => {\n      try {\n        callback(status);\n      } catch (error) {\n        console.error('Service worker callback error:', error);\n      }\n    });\n  }\n}\n\n// Export singleton instance\nexport const swManager = new ServiceWorkerManager();\n\n/**\n * Register service worker (convenience function)\n */\nexport async function registerServiceWorker(): Promise<ServiceWorkerRegistration | null> {\n  return swManager.register();\n}\n\n/**\n * Unregister service worker (convenience function)\n */\nexport async function unregisterServiceWorker(): Promise<boolean> {\n  return swManager.unregister();\n}\n"]}