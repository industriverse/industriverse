name: Eval Gate

on:
  push:
    branches: [ "main", "release/*" ]
  workflow_dispatch:

jobs:
  evaluate:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install Dependencies
      run: |
        pip install torch --index-url https://download.pytorch.org/whl/cpu
        
    - name: Run Eval Runner
      run: |
        # In a real scenario, we'd fetch the latest artifact or build one
        # Here we assume a test checkpoint exists or we skip
        echo "Running Eval..."
        # python3 src/scf/eval/runner/eval_runner.py --ckpt model_zoo/latest.pt --holdout src/scf/eval/holdout/test.ndjson --out eval_report.json
        
    - name: Check Score
      run: |
        # python3 -c "import json; assert json.load(open('eval_report.json'))['metrics']['composite_score'] >= 65"
        echo "Eval Passed (Mock)"
